<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>موزیک پلیر پیشرفته - لیست موزیک</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap');
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Vazirmatn', sans-serif;
    background: linear-gradient(270deg, #1a2a6c, #b21f1f, #fdbb2d);
    background-size: 600% 600%;
    animation: bgGradient 25s ease infinite;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  @keyframes bgGradient {
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
  }
  h1 {
    margin: 20px 0;
    text-shadow: 0 0 10px #ffd700;
  }
  #music-list {
    width: 95%;
    max-width: 450px;
    max-height: 300px;
    overflow-y: auto;
    background: rgba(0,0,0,0.6);
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 0 25px #ffd700;
  }
  .track {
    padding: 10px;
    border-bottom: 1px solid #444;
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .track:hover {
    background: #ffd700;
    color: #111;
  }
  .track.active {
    background: #ffb700;
    color: #111;
    font-weight: bold;
  }
  #player-controls {
    margin-top: 25px;
    width: 90%;
    max-width: 450px;
    background: rgba(0,0,0,0.7);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 25px #ffd700;
    text-align: center;
  }
  audio {
    width: 100%;
    outline: none;
    border-radius: 12px;
    box-shadow: 0 0 15px #ffb700;
  }
  .buttons {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  button {
    background: #ffb700;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 24px;
    cursor: pointer;
    color: #111;
    font-weight: bold;
    box-shadow: 0 0 15px #ffb700;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #ffd633;
  }
</style>
</head>
<body>

<h1>🎵 موزیک‌های گوشی شما</h1>
<div id="music-list">هیچ موزیکی یافت نشد یا منتظر لیست موزیک‌ها هستیم...</div>

<div id="player-controls" style="display:none;">
  <audio id="audio-player" controls></audio>
  <div class="buttons">
    <button id="prev" title="آهنگ قبلی">⏮️</button>
    <button id="play-pause" title="پخش / توقف">▶️</button>
    <button id="next" title="آهنگ بعدی">⏭️</button>
  </div>
</div>

<script>
  let musicListElement = document.getElementById('music-list');
  let audioPlayer = document.getElementById('audio-player');
  let playerControls = document.getElementById('player-controls');
  let playPauseBtn = document.getElementById('play-pause');
  let prevBtn = document.getElementById('prev');
  let nextBtn = document.getElementById('next');

  let tracks = [];
  let currentIndex = -1;

  // تابعی که از اندروید صدا زده میشه و لیست موزیک‌ها رو میده به صورت JSON string
  function setMusicList(jsonString) {
    try {
      tracks = JSON.parse(jsonString);
      if(!Array.isArray(tracks) || tracks.length === 0) {
        musicListElement.innerHTML = "هیچ موزیکی یافت نشد.";
        playerControls.style.display = "none";
        return;
      }
      currentIndex = 0;
      renderMusicList();
      loadTrack(currentIndex);
      playerControls.style.display = "block";
    } catch(e) {
      musicListElement.innerHTML = "خطا در بارگذاری لیست موزیک‌ها";
      console.error(e);
    }
  }

  function renderMusicList() {
    musicListElement.innerHTML = "";
    tracks.forEach((track, i) => {
      let div = document.createElement('div');
      div.className = "track" + (i === currentIndex ? " active" : "");
      div.textContent = track.title || ("آهنگ شماره " + (i+1));
      div.title = track.artist ? (track.artist + " - " + track.album) : "";
      div.onclick = () => {
        if(currentIndex !== i){
          currentIndex = i;
          loadTrack(currentIndex);
          playAudio();
          updateActiveTrack();
        }
      };
      musicListElement.appendChild(div);
    });
  }

  function loadTrack(index) {
    if(index < 0 || index >= tracks.length) return;
    const track = tracks[index];
    audioPlayer.src = track.path;
    audioPlayer.load();
  }

  function updateActiveTrack() {
    let trackDivs = musicListElement.querySelectorAll('.track');
    trackDivs.forEach((div,i) => {
      if(i === currentIndex) div.classList.add('active');
      else div.classList.remove('active');
    });
  }

  function playAudio() {
    audioPlayer.play();
    playPauseBtn.textContent = "⏸️";
  }

  function pauseAudio() {
    audioPlayer.pause();
    playPauseBtn.textContent = "▶️";
  }

  playPauseBtn.onclick = () => {
    if(audioPlayer.paused) {
      playAudio();
    } else {
      pauseAudio();
    }
  };

  prevBtn.onclick = () => {
    if(tracks.length === 0) return;
    currentIndex = (currentIndex - 1 + tracks.length) % tracks.length;
    loadTrack(currentIndex);
    playAudio();
    updateActiveTrack();
  };

  nextBtn.onclick = () => {
    if(tracks.length === 0) return;
    currentIndex = (currentIndex + 1) % tracks.length;
    loadTrack(currentIndex);
    playAudio();
    updateActiveTrack();
  };

  audioPlayer.onended = () => {
    nextBtn.onclick();
  };

  // برای تست محلی، یک لیست فرضی اینجا می‌گذاریم (این خط رو توی اپ واقعی حذف کن)
  /*
  setMusicList(JSON.stringify([
    {title:"آهنگ تست ۱", artist:"خواننده ۱", album:"آلبوم ۱", path:"sample1.mp3"},
    {title:"آهنگ تست ۲", artist:"خواننده ۲", album:"آلبوم ۲", path:"sample2.mp3"}
  ]));
  */

</script>

</body>
</html>
